{% extends "graph.j2" %}
{% from "macros/attributes.j2" import build_attrs %}
{% from "macros/nodes.j2" import build_class %}
{% from "macros/edges.j2" import build_parents, build_dependencies %}

{# BUILD #}
{% set built = namespace(classes="", parents="", dependencies="") %}
{% for node in classes %}
    {% set class_node = build_class(node) %}
    {% set parent_edges = build_parents(node) %}
    {% set dep_edges = build_dependencies(node) %}

    {# BUILD CLASS #}
    {% if class_node %}
        {% set built.classes = built.classes + class_node + "\n\n" %}
    {% endif %}

    {# BUILD PARENTS #}
    {% if parent_edges %}
        {% set built.parents = built.parents + parent_edges + "\n" %}
    {% endif %}

    {# BUILD DEPENDENCIES #}
    {% if dep_edges %}
        {% set built.dependencies = built.dependencies + dep_edges + "\n\n" %}
    {% endif %}
{% endfor %}

{% block graph_attrs %}
{{ build_attrs(graph) -}}
{% endblock %}

{% block legend %}
    /*
    * LEGEND
    */
   subgraph cluster_0LEGEND {
        label=< <FONT POINT-SIZE="28"><B>Legend</B></FONT> >;

        LEGEND_inheritance_parent [shape=rect label="Parent Class"];
        LEGEND_inheritance_child [shape=rect label="Child Class"];
        LEGEND_dependency_a [shape=rect label="Class A"];
        LEGEND_dependency_b [shape=rect label="Class B"];
        LEGEND_meta_a [shape=rect label="Metaclass"];
        LEGEND_meta_b [shape=rect label="Class(metaclass=Metaclass)"];

        LEGEND_inheritance_parent -> LEGEND_inheritance_child [fontsize=20 style=dashed arrowhead=empty label="Inherited by"];
        LEGEND_dependency_a -> LEGEND_dependency_b [fontsize=20 label="Dependency of"];
        LEGEND_meta_a -> LEGEND_meta_b [fontsize=20 style=dashed color="royalblue2" label="Metaclass for"]
    }
{% endblock %}

{% block nodes %}
/* Classes */
{{ built.classes -}}
{% endblock %}

{% block clusters %}
    {%- for name, classes in subpackages.items() -%}
        {{- '\nsubgraph cluster_' + name +' {' -}}
        {{- '\n\tlabel=< <FONT POINT-SIZE="26">' + name + '</FONT> >' -}}
        {{- '\n\tstyle=dashed\n' -}}
        {%- for node in classes -%}
        {{- '\n\t\t' + node -}}
        {%- endfor -%}
        {{- '\n}' -}}
    {%- endfor -%}
{% endblock %}

{% block edges %}
/* Inheritance */
{{ built.parents -}}

/* Dependencies */
{{ built.dependencies -}}
{% endblock %}